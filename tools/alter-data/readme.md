



# æ•°æ®ä¸€è‡´æ€§ç›‘æ§çœ‹æ¿

## é¡¹ç›®æ¦‚è¿°
è¿™æ˜¯ä¸€ä¸ªç›‘æ§çœ‹æ¿ï¼Œä¸»è¦ç”¨äºå¯¹æ¯”ä¸åŒ tenant çš„ä¸åŒ platform çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæ£€æµ‹ API æ•°æ®ä¸å®é™…å¹¿å‘Šæ•°æ®ä¹‹é—´çš„å·®å¼‚ã€‚

## åŠŸèƒ½ç‰¹æ€§
- **å¤šç§Ÿæˆ·ç›‘æ§**ï¼šæ¯ä¸ª tenant ç‹¬ç«‹æ˜¾ç¤ºä¸€ä¸ªå›¾è¡¨
- **æ•°æ®å¯¹æ¯”**ï¼šå¯¹æ¯” API æ¶ˆè´¹æ•°æ® vs å¹¿å‘Šå®é™…æ¶ˆè´¹æ•°æ®
- **æ™ºèƒ½æ’åº**ï¼šæŒ‰å·®å¼‚å€¼å¤§å°æ’åºï¼Œå·®å¼‚æœ€å¤§çš„ç§Ÿæˆ·æ’åœ¨å‰é¢
- **å¯è§†åŒ–å±•ç¤º**ï¼šä½¿ç”¨ ECharts è¿›è¡Œæ•°æ®å¯è§†åŒ–
- **å“åº”å¼å¸ƒå±€**ï¼šä¸€è¡Œå±•ç¤º 3 ä¸ªå›¾è¡¨ï¼Œè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- **ä¸€ä½“åŒ–éƒ¨ç½²**ï¼šå‰åç«¯é›†æˆï¼Œè¿è¡Œ `main.go` å³å¯å¯åŠ¨å®Œæ•´æœåŠ¡

## æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
```
â”œâ”€â”€ main.go                 # ä¸»ç¨‹åºå…¥å£ï¼Œå¯åŠ¨ HTTP æœåŠ¡
â”œâ”€â”€ handlers/               # HTTP å¤„ç†å™¨
â”‚   â”œâ”€â”€ api.go             # REST API è·¯ç”±å’Œå¤„ç†é€»è¾‘
â”‚   â””â”€â”€ static.go          # é™æ€æ–‡ä»¶æœåŠ¡
â”œâ”€â”€ platforms/             # æ•°æ®å¹³å°æ¨¡å—
â”‚   â”œâ”€â”€ model.go           # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ google.go          # Google Ads æ•°æ®å¤„ç†
â”‚   â”œâ”€â”€ meta.go            # Meta æ•°æ®å¤„ç† (é¢„ç•™)
â”‚   â”œâ”€â”€ interface.go       # å¹³å°æ¥å£å®šä¹‰
â”‚   â””â”€â”€ registry.go        # å¹³å°æ³¨å†Œç®¡ç†
â”œâ”€â”€ query_sql/             # SQL æŸ¥è¯¢æ¨¡å—
â”‚   â”œâ”€â”€ google.go          # Google Ads æŸ¥è¯¢è¯­å¥
â”‚   â””â”€â”€ meta.go            # Meta æŸ¥è¯¢è¯­å¥ (é¢„ç•™)
â””â”€â”€ static/                # å‰ç«¯é™æ€æ–‡ä»¶
    â”œâ”€â”€ index.html         # ä¸»é¡µé¢
    â”œâ”€â”€ js/
    â”‚   â”œâ”€â”€ app.js         # ä¸»åº”ç”¨é€»è¾‘
    â”‚   â”œâ”€â”€ platform.js    # å¹³å°åˆ‡æ¢é€»è¾‘
    â”‚   â”œâ”€â”€ chart.js       # ECharts å›¾è¡¨ç®¡ç†
    â”‚   â””â”€â”€ echarts.min.js # ECharts åº“
    â””â”€â”€ css/
        â””â”€â”€ style.css      # æ ·å¼æ–‡ä»¶
```

### å‰ç«¯æ¶æ„
```
Dashboard Layout:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®ç›‘æ§çœ‹æ¿                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Platform: [Google Ads â–¼] [Meta â–¼] [TikTok â–¼] ...     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Tenant 1 Chart]  [Tenant 2 Chart]  [Tenant 3 Chart] â”‚
â”‚  [Tenant 4 Chart]  [Tenant 5 Chart]  [Tenant 6 Chart] â”‚
â”‚  ...                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**äº¤äº’æµç¨‹ï¼š**
1. é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºé»˜è®¤å¹³å° (Google Ads) çš„æ‰€æœ‰ç§Ÿæˆ·å›¾è¡¨
2. ç”¨æˆ·ç‚¹å‡»å¹³å°é€‰æ‹©å™¨åˆ‡æ¢å¹³å°
3. å‰ç«¯å‘é€ API è¯·æ±‚è·å–æ–°å¹³å°æ•°æ®
4. å›¾è¡¨åŒºåŸŸåŠ¨æ€æ›´æ–°æ˜¾ç¤ºæ–°å¹³å°çš„ç§Ÿæˆ·æ•°æ®

**å‰ç«¯åŠŸèƒ½æ¨¡å—ï¼š**
```javascript
// platform.js - å¹³å°ç®¡ç†
class PlatformManager {
  loadPlatforms()     // åŠ è½½å¯ç”¨å¹³å°åˆ—è¡¨
  switchPlatform()    // åˆ‡æ¢å¹³å°æ—¶çš„å¤„ç†é€»è¾‘
  getCurrentPlatform() // è·å–å½“å‰é€‰ä¸­å¹³å°
}

// chart.js - å›¾è¡¨ç®¡ç†  
class ChartManager {
  initChart()         // åˆå§‹åŒ–å›¾è¡¨å®¹å™¨
  updateChartData()   // æ›´æ–°å›¾è¡¨æ•°æ®
  createTenantChart() // åˆ›å»ºå•ä¸ªç§Ÿæˆ·å›¾è¡¨
  destroyCharts()     // é”€æ¯ç°æœ‰å›¾è¡¨
}

// app.js - ä¸»åº”ç”¨é€»è¾‘
class Dashboard {
  init()              // åº”ç”¨åˆå§‹åŒ–
  loadPlatformData()  // åŠ è½½å¹³å°æ•°æ®
  renderCharts()      // æ¸²æŸ“å›¾è¡¨ç½‘æ ¼
  handlePlatformChange() // å¤„ç†å¹³å°åˆ‡æ¢äº‹ä»¶
}
```

### API æ¥å£è®¾è®¡
```
GET /api/platforms        # è·å–æ‰€æœ‰å¯ç”¨å¹³å°åˆ—è¡¨
GET /api/tenants          # è·å–æ‰€æœ‰ç§Ÿæˆ·åˆ—è¡¨  
GET /api/data/{platform}  # è·å–æŒ‡å®šå¹³å°æ‰€æœ‰ç§Ÿæˆ·çš„æ•°æ®
GET /api/data/{platform}/{tenant_id}  # è·å–æŒ‡å®šç§Ÿæˆ·çš„å¹³å°æ•°æ®
```

**API å“åº”ç¤ºä¾‹ï¼š**
```json
// GET /api/platforms
{
  "success": true,
  "data": [
    {"name": "google", "display_name": "Google Ads"},
    {"name": "meta", "display_name": "Meta Ads"},
    {"name": "tiktok", "display_name": "TikTok Ads"}
  ]
}

// GET /api/data/google
{
  "success": true,
  "platform": "google",
  "data": [
    {
      "tenant_id": 1001,
      "tenant_name": "Tenant A", 
      "date_range": ["2024-01-01", "2024-01-02", "..."],
      "api_spend": [1000, 1200, ...],
      "ad_spend": [980, 1180, ...],
      "difference": [20, 20, ...]
    }
  ]
}
```

### æ™ºèƒ½æ’åºç®—æ³•
ç³»ç»Ÿä¼šè‡ªåŠ¨è®¡ç®—æ¯ä¸ªç§Ÿæˆ·çš„æ€»å·®å¼‚å€¼ï¼Œå¹¶æŒ‰ä»¥ä¸‹è§„åˆ™æ’åºï¼š

1. **å·®å¼‚å€¼è®¡ç®—**ï¼šå¯¹æ¯ä¸ªç§Ÿæˆ·çš„æ‰€æœ‰æ—¥æœŸå·®å¼‚å€¼å–ç»å¯¹å€¼æ±‚å’Œ
2. **æ’åºè§„åˆ™**ï¼šå·®å¼‚å€¼è¶Šå¤§çš„ç§Ÿæˆ·æ’åœ¨è¶Šå‰é¢
3. **å®æ—¶æ›´æ–°**ï¼šæ¯æ¬¡æ•°æ®åˆ·æ–°æ—¶è‡ªåŠ¨é‡æ–°æ’åº

**ç¤ºä¾‹æ’åºç»“æœ**ï¼š
- Tenant 150181: æ€»å·®å¼‚ 4,441,802 (æ’ç¬¬1)
- Tenant 150179: æ€»å·®å¼‚ 4,441,705 (æ’ç¬¬2)  
- Tenant 133857: æ€»å·®å¼‚ 4,365,577 (æ’ç¬¬3)

### æ•°æ®æ¨¡å‹
```go
// å¹³å°ä¿¡æ¯
type PlatformInfo struct {
    Name        string `json:"name"`         // å¹³å°æ ‡è¯†: google, meta, tiktok
    DisplayName string `json:"display_name"` // æ˜¾ç¤ºåç§°: Google Ads, Meta Ads
}

// ç§Ÿæˆ·æ•°æ®
type TenantData struct {
    TenantID   int64    `json:"tenant_id"`
    TenantName string   `json:"tenant_name"`
    Platform   string   `json:"platform"`
    DateRange  []string `json:"date_range"`
    APISpend   []int64  `json:"api_spend"`
    AdSpend    []int64  `json:"ad_spend"`
    Difference []int64  `json:"difference"`
}

// API å“åº”æ ¼å¼
type PlatformResponse struct {
    Success bool           `json:"success"`
    Data    []PlatformInfo `json:"data"`
    Message string         `json:"message"`
}

type DashboardResponse struct {
    Success  bool         `json:"success"`
    Platform string       `json:"platform"`
    Data     []TenantData `json:"data"`
    Message  string       `json:"message"`
}
```

### ECharts å›¾è¡¨é…ç½®
- **å›¾è¡¨ç±»å‹**ï¼šæŠ˜çº¿å›¾ï¼Œæ˜¾ç¤ºæ—¶é—´è¶‹åŠ¿
- **æ—¶é—´æ’åº**ï¼šå‰ç«¯è‡ªåŠ¨æŒ‰æ—¥æœŸé€’å¢æ’åºï¼Œç¡®ä¿æ—¶é—´è½´æ­£ç¡®æ˜¾ç¤º
- **æ—¶é—´æ ‡è®°**ï¼šè‡ªåŠ¨æ˜¾ç¤º30å¤©å‰æ ‡è®°çº¿ï¼ˆæ©™è‰²è™šçº¿ï¼Œå¸¦"30å¤©å‰"æ ‡ç­¾ï¼‰
- **å›¾è¡¨å°ºå¯¸**ï¼šæ¡Œé¢ç«¯420pxé«˜åº¦ï¼Œç§»åŠ¨ç«¯è‡ªé€‚åº”ï¼Œç¡®ä¿æ—¥æœŸæ ‡ç­¾å®Œæ•´æ˜¾ç¤º
- **æ•°æ®ç³»åˆ—**ï¼š
  - API æ¶ˆè´¹æ•°æ® (è“è‰²çº¿)
  - å¹¿å‘Šå®é™…æ¶ˆè´¹ (çº¢è‰²çº¿)  
  - å·®å¼‚å€¼ (æ©™è‰²æŸ±çŠ¶å›¾)
- **äº¤äº’åŠŸèƒ½**ï¼š
  - é¼ æ ‡æ‚¬åœæ˜¾ç¤ºè¯¦ç»†æ•°å€¼
  - å›¾ä¾‹ç‚¹å‡»æ§åˆ¶ç³»åˆ—æ˜¾ç¤º/éšè—
  - æ•°æ®ç¼©æ”¾åŠŸèƒ½

## æ‰©å±•è®¾è®¡

### å¹³å°æ¥å£ (Interface)
```go
type Platform interface {
    GetName() string
    GetTenantData(tenantID int64, days int) ([]AlterData, error)
    GetAllTenantsData(days int) (map[int64][]AlterData, error)
}
```

### å¹³å°æ³¨å†Œæœºåˆ¶
```go
// æ”¯æŒåŠ¨æ€æ³¨å†Œæ–°å¹³å°
func RegisterPlatform(name string, platform Platform)
func GetPlatform(name string) (Platform, error)
func GetAllPlatforms() map[string]Platform
```

## éƒ¨ç½²æ–¹å¼
```bash
# å¯åŠ¨æœåŠ¡
go run main.go

# æœåŠ¡å°†åœ¨ http://localhost:8080 å¯åŠ¨
# å‰ç«¯é¡µé¢ï¼šhttp://localhost:8080
# API ç«¯ç‚¹ï¼šhttp://localhost:8080/api/*
```

## å¼€å‘è®¡åˆ’
1. âœ… æ•°æ®æ¨¡å‹è®¾è®¡
2. âœ… Google Ads æ•°æ®æŸ¥è¯¢
3. ğŸš§ HTTP æœåŠ¡å’Œ API æ¥å£
4. ğŸš§ å¹³å°æ¥å£å’Œæ³¨å†Œæœºåˆ¶
5. ğŸš§ å‰ç«¯é¡µé¢å’Œ ECharts é›†æˆ  
6. ğŸš§ å¹³å°é€‰æ‹©å™¨åŠŸèƒ½
7. ğŸš§ å¤šç§Ÿæˆ·æ•°æ®å±•ç¤º
8. â³ Meta å¹³å°é¢„ç•™æ¥å£
9. â³ å…¶ä»–å¹³å°æ‰©å±•æœºåˆ¶

**å¼€å‘ä¼˜å…ˆçº§ï¼š**
- **Phase 1**: åç«¯ API æœåŠ¡ (platformsæ¥å£ã€HTTP handlers)
- **Phase 2**: å‰ç«¯åŸºç¡€æ¡†æ¶ (HTMLã€å¹³å°é€‰æ‹©å™¨ã€å›¾è¡¨å®¹å™¨)  
- **Phase 3**: æ•°æ®å¯è§†åŒ– (ECharts é›†æˆã€åŠ¨æ€æ›´æ–°)
- **Phase 4**: åŠŸèƒ½å®Œå–„ (é”™è¯¯å¤„ç†ã€åŠ è½½çŠ¶æ€ã€å“åº”å¼å¸ƒå±€)
